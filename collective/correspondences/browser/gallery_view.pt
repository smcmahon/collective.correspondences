<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">
<body>

<metal:content-core fill-slot="content-core">
    <metal:content-core define-macro="content-core">

<script>
$(function() {
    // initialize scrollable
    $("#navigator")
        .scrollable()
        .navigator();

    var api = $("#navigator").data("scrollable");

    $('table.citem').click(function(event) {
        var jqthis = $(this),
            url = jqthis.find('a').attr('href'),
            image_wrap = $('#image_wrap');

    	event.preventDefault();

    	// see if same thumb is being clicked
    	if ($(this).hasClass("active")) { return; }

    	// activate item
    	$(".citem").removeClass("active");
    	jqthis.addClass("active");

    	image_wrap.children().fadeOut();
    	image_wrap.load(url + " #content-core > *");

    	if ((api.getIndex() > 0) || jqthis.prev('.citem').length) {
    	    $('.previmage').show();
    	} else {
    	    $('.previmage').hide();
    	}
    	if ((api.getIndex() + 1 < api.getSize()) || $('table.active').next('.citem').length) {
    	    $('.nextimage').show();
    	} else {
    	    $('.nextimage').hide();
    	}

    }).filter(":first").click();

    $(".nextimage").on('click', function(event) {
        var active = $('table.active'),
            next = active.next('table.citem');

        if (next.length) {
            next.click();
        } else {
            if (api.getIndex() + 1 < api.getSize()) {
                active.removeClass('active');
                api.next();
                $(api.getItems()[api.getIndex()]).children().first().click()
            }
        }
    });
    $(".previmage").on('click', function(event) {
        var active = $('table.active'),
            prev = active.prev('table.citem');

        if (prev.length) {
            prev.click();
        } else {
            if (api.getIndex() > 0) {
                active.removeClass('active');
                api.prev();
                $(api.getItems()[api.getIndex()]).children().last().click()
            }
        }
    });

    $(".major_wrapper").fadeIn();

});



</script>

<style>
@import url(++resource++collective.correspondences/scrollable-navigator.css);
@import url(++resource++collective.correspondences/scrollable-buttons.css);

.citem a {
    border: none !important;
    text-decoration: none;
}
table.citem {
    background-color: #7A663B;
}
table.active {
    background-color: #fff;
    box-shadow: 0 0 20px #000;
}
.items a div {
    float: left;
    text-align: center;
    padding-right: 4px;
}
.citem img {
    vertical-align: bottom;
}
.citem a:first-child {
  margin-right: 6px;
}
.cblock {
    width: 840px;
    text-align: center;
}

/*
root element for the scrollable.  when scrolling occurs this
element stays still.
*/
.scrollable {
  /* required settings */
  position:relative;
  overflow:hidden;
  width: 840px;
  height: 152px;
  background-color: #834B2D;
}

/*
root element for scrollable items. Must be absolutely positioned
and it should have a extremely large width to accommodate scrollable
items.  it's enough that you set width and height for the root element
and not for this element.
*/
.scrollable .items {
  /* this cannot be too large */
  width:20000em;
  position:absolute;
}

/*
a single item. must be floated in horizontal scrolling.  typically,
this element is the one that *you* will style the most.
*/
.items .cblock {
  float:left;
  width: 840px;
  text-align: center;
  padding: 6px 0;
}
table.citem {
  display: inline-block;
  padding: 6px;
  margin: 0 6px 0 0;
}
table.citem:last-child {
  margin: 0;
}
.items .citem tr {
  vertical-align: bottom;
}
table.citem td {
    height: 128px;
}

.navi {
    width: auto;
    margin: 0 auto;
    display: inline-block;
}

#image_wrap {
    /* dimensions */
    display: inline-block;
    width: 840px;
    height: 420px;
    padding: 15px 0;

    text-align:center;

    clear: both;

    background-color:#834B2D;
}
#image_wrap img {
    box-shadow: 0 0 20px #000;
}
.cdiv {
    display: inline-block;
}
.nextimage, .previmage {
    display: inline-block;
    font-size: 200%;
    width: 1em;
    text-align: center;
    cursor: pointer;
}

#image_wrap td a {
    color: #fff !important;
}
#image_wrap td {
  padding-top: 12px;
}
.cdiv:first-child {
    margin-right: 6px;
}
</style>

<div tal:define="subgs python:context.getFolderContents(contentFilter={'portal_type':'gallery'})"
     tal:condition="subgs">
     <ul>
        <li tal:repeat="subg subgs">
            <a tal:content="subg/Title" tal:attributes="href subg/getURL" />
        </li>
    </ul>
 </div>


<div class="major_wrapper" style="display:none">
    <div class="previmage">&lt;</div>
    <div id="image_wrap">
    </div>
    <div class="nextimage">&gt;</div>
    <br style="clear:both" />
    <a class="prev browse left">Left</a>

    <div class="scrollable" id="navigator">
        <div class="items">
            <div tal:repeat="block view/getCorrespondences" class="cblock">
                <table class="citem" tal:repeat="item block"><tr>
                    <td><a tal:attributes="href item/url; title item/description" tal:repeat="tag item/image_tags" ><img tal:replace="structure tag" /></a></td>
                </tr></table>
            </div>
        </div>
    </div>

    <a class="next browse right">Right</a>
    <div class="navi"></div>
</div>


    </metal:content-core>
</metal:content-core>

</body>
</html>